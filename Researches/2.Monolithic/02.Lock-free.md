---
sort: 2
---

# Lock-free 기법 연구

## 연구배경

멀티코어 머신에서 멀티스레드는 공유된 자원(자료구조)을 동시에 접근하는 일이 자주 발생하며 동시에 실행되는 스레드 갯수가 증가할수록 시스템의 성능은 공유자원 접근 방법 (동기화 매커니즘)에 따라 크게 좌우된다. 운영체제, 데이터베이스 시스템, 네트워크 스택, 저장장치 시스템 등 대부분의 소프트웨어 설계에서 동기화 매커니즘은 필수적인 요소이며 성능에 큰 영향을 미친다. 최근 프로세서 코어 개수의 증가와 하드웨어 병렬성은 빠르게 발전하고 있지만 소프트웨어의 성능 확장성은 하드웨어 발전에 미치지 못한다. 아래 표는 기존 동기화 기법들의 특성을 항목별로 비교한 것이다. 동기화 방식에 따라 다양한 알고리즘이 존재하지만, 최신 멀티코어 머신의 하드웨어 성능에 비례하여 성능 확장성을 제공하는 알고리즘은 없다. 그림은 hash table (1000개의 element)을 멀티 스레드가 동시에 읽고 쓰는 워크로드의 성능을 측정한 결과이다. x축은 동시 실행 스레드 개수를 나타내며 y축은 연산 처리량을 보여준다. 실행 스레드 개수가 100 코어를 초과하는 경우 성능 확장성을 제공하는 기존 동기화 매커니즘이 없음을 알 수 있다. 그리고 본 연구에서 제안하는 동기화 매커니즘인 MV-RLU (Multi version-Read Log Update)만 성능 확장성을 제공함을 알 수 있다.

## 연구 내용

본 연구에서 제안하는 MV-RLU 이름에서 알 수 있듯이 RLU (Read Log Update)라는 기존 기법의 장점을 계승하고 성능을 크게 향상시켰다. MV-RLU의 구성요소는 멀티버전 로깅과 로그 버퍼의 재활용 정책이다. 멀티버전 로깅은 멀티스레드가 공유자원을 동시에 접근하도록 하는 메커니즘이다. 하나의 노드 또는 오브젝트를 버전 체인으로 연결하여 멀티버전화 하고 각 버전에 타임스탬프를 부여하여 각 스레드가 각자 적합한 버전을 접근할 수 있도록 하는 구조이다. 이 매커니즘은 전통적인 데이터베이스 시스템에서 지원하는 기법이지만 버전 체인 트레버스 비용과 로그 버퍼의 재활용 시 발생하는 성능 하락이 가장 큰 문제점으로 지적되었다. 이와 같은 전통적인 멀티버전의 문제점을 해결하기 위하여 각 쓰레드별로 로그 버퍼 재활용을 병렬적으로 (concurrent GC) 수행하고 버전 체인 트레버스 비용을 줄이기 위해 로그 버퍼 재활용을 자동화 (autonomous GC) 시키고 타임스탬프 발행 비용을 최소화하기 위해 하드웨어 클럭 기반 (ORDO 기법 - “A Scalable Ordering Primitive for Multicore Machines” 논문) 타임스탬프를 차용하였다. 이러한 다양한 기법들을 통해 멀티스레드가 공유자원을 접근하는 컴퓨팅 환경에서 기존 기법들에 비해 월등히 높은 성능 (448 코어 머신에서 기존 기법대비 최대 600배 성능향상)을 제공한다.

### 실험

다음 그림은 Linked list, Hash table, Binary search tree 자료구조에서 성능 측정한 결과로 거의 모든 실험 시나리오에서 MV-RLU가 성능 확장성을 제공함을 알 수 있다.

## 연구 결과물

본 연구결과는 멀티스레드가 공유자원을 효율적으로 접근할 수 있는 구조를 응용 소프트웨어에 제공하여 성능 향상을 도모하는 범용 프레임워크이며 직관적인 응용 프로그래밍 인터페이스 (Simple application program interface), 범용적인 프레임워크 (General framework), 다양한 자료구조 결합성 (Composability)와 같은 장점을 가진다. 따라서 멀티스레드 환경의 대부분의 응용 (예: 운영체제 커널, 파일시스템, 데이터베이스 시스템, 사용자 응용 프로그램)에서 활용 할 수 있다. 

### 공개소프트웨어

MV-RLU : <https://github.com/cosmoss-vt/mv-rlu>

### 발표논문

ASPLOP2019, “MV-RLU: Scaling Read-Log-Update with Multi-Versioning”
